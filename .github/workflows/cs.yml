
name: 测试
# 分支 应替换为  branches
on:
  schedule:
    - cron: '18 22 * * *'
  workflow_dispatch:
    branches:
      - main

permissions:
  contents: write
  
jobs:
  run_script:
    runs-on: ubuntu-latest

    steps:
    - name: Set branch name
      id: vars
      run: echo "BRANCH_NAME=${{ github.repository_owner == 'Guovin' && 'gd' || 'master' }}" >> $GITHUB_ENV
    - uses: actions/checkout@v3
      with:
        ref: ${{ env.BRANCH_NAME }}
    - name: Run with setup-python 3.8
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'
        update-environment: true
        cache: 'pipenv'
    - name: Install Selenium
      run: |
        sudo pip3 install selenium
    - name: Set up Chrome
      uses: browser-actions/setup-chrome@latest
      with:
        chrome-version: stable
    - name: Download chrome driver
      uses: nanasess/setup-chromedriver@master
    - name: Launch chrome driver
      run: |
        export DISPLAY=:99
        chromedriver --url-base=/wd/hub &
        sudo Xvfb -ac :99 -screen 0 1280x1024x24 > /dev/null 2>&1 & # optional
    - name: Install pipenv
      run: pip3 install --user pipenv
    - name: Install dependecies
      run: pipenv --python 3.8 && pipenv install

    - name: Run blacklist update
      run: python ${{ github.workspace }}/cs.py
        
    - name: Commit results
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        if [ -n "$(git status --porcelain)" ]; then
        git add iptv.txt online.txt 
        # iptv.m3u blacklist.txt whitelist.txt tv.txt live.txt online.txt others.txt 
        git commit -m "Automatic update"
        git push
        else
          echo "No changes detected, skipping commit."
        fi
  
env:
  TZ: Asia/Shanghai
